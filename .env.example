# Copy to .env and fill in values. Placeholders only.
# VM deploy: copy to .env, run scripts/gen_secrets.sh and paste secrets, then fill remaining keys.
# Validation: API and Worker call scripts/validate_env.py on startup; missing required vars = refuse to start.
# VM-first: inside containers use service DNS only (no localhost). Compose sets DATABASE_URL etc.

# --- Required for VM: run scripts/gen_secrets.sh to generate secrets, then paste below ---
POSTGRES_PASSWORD=
JWT_SECRET=
API_KEY=
ADMIN_API_KEY=
WA_QR_BRIDGE_TOKEN=

# --- VM-first (in-container): use service hostnames. Required when running in Docker. ---
DATABASE_URL=postgresql://gni:gni@postgres:5432/gni
REDIS_URL=redis://redis:6379/0
OLLAMA_BASE_URL=http://ollama:11434
WHATSAPP_BOT_BASE_URL=http://whatsapp-bot:3100

# VM deployment path (e.g. /opt/gni-bot-creator)
DEPLOY_PATH=

# Postgres (compose builds DATABASE_URL from these; set POSTGRES_PASSWORD above via gen_secrets.sh)
POSTGRES_USER=gni
POSTGRES_DB=gni

# Connection pool (optional; defaults: pool_size=5, max_overflow=10, pool_recycle=1800)
# DB_POOL_SIZE=
# DB_MAX_OVERFLOW=
# DB_POOL_RECYCLE=
# DB_POOL_TIMEOUT=

# Worker (RQ)
RQ_QUEUE=

# API (port 8000 exposed publicly)
API_HOST=
API_PORT=8000
API_SECRET_KEY=
# API security (optional; when unset, auth disabled for backward compat)
JWT_SECRET=
API_KEY=
# ADMIN_API_KEY: fallback for local testing when API_KEY not set
ADMIN_API_KEY=
# JWT token expiry in seconds (default 86400 = 24h). Empty = use default.
JWT_EXPIRY_SECONDS=86400
# API rate limit per IP/token: per minute, per hour (defaults: 60, 1000)
API_RATE_LIMIT_PER_MINUTE=
API_RATE_LIMIT_PER_HOUR=
# API request body max size in bytes (default: 65536)
API_MAX_BODY_SIZE=
# CORS: comma-separated allowed origins (empty = none)
CORS_ALLOWED_ORIGINS=
# Observability: JSON logs (LOG_JSON=1), log level (LOG_LEVEL), metrics port (worker)
LOG_JSON=
LOG_LEVEL=
METRICS_PORT=
# OpenTelemetry: set OTEL_EXPORTER_OTLP_ENDPOINT to enable tracing
OTEL_EXPORTER_OTLP_ENDPOINT=

# Collector (RSS + Telegram ingest on interval; worker does scoring→LLM→publish). With docker compose up -d, flux runs 24/7.
COLLECTOR_INTERVAL_MINUTES=15
COLLECTOR_INTERVAL=
RSS_SOURCES_PATH=
# CNBC Finance feed (sources.yaml uses this key); set to actual RSS URL when available
CNBC_RSS_URL_PLACEHOLDER=

# Worker (pipeline scheduler). Use service names for DB/Redis/Ollama.
# OLLAMA_BASE_URL: default http://ollama:11434 (no localhost inside containers)
OLLAMA_BASE_URL=http://ollama:11434
# OLLAMA_MODEL: VM-friendly 7B/14B for classify + JSON generation (not 32B)
OLLAMA_MODEL=qwen2.5:7b
# Pull model on worker startup if missing (fresh VM)
OLLAMA_PULL_ON_START=true
OLLAMA_PULL_TIMEOUT_SECONDS=1800
OLLAMA_PULL_MAX_RETRIES=6
OLLAMA_PULL_BACKOFF_SECONDS=20
# OLLAMA_MODE: native (default, /api/chat) | openai_compat (/v1/chat/completions)
OLLAMA_MODE=
RUN_EVERY_MINUTES=
INGEST_LIMIT=
# Ollama client (async): request timeout (default 120s), max JSON retry (default 1)
OLLAMA_REQUEST_TIMEOUT=
OLLAMA_MAX_JSON_RETRY=
# Cache: TTL in seconds for score + LLM (default 86400 = 24h); Redis or in-memory fallback
CACHE_TTL_SECONDS=
# Dedupe window in days: same fingerprint within window is dropped (default: 7)
DEDUPE_DAYS=
# Dedupe policy: strict (exact fingerprint) | relaxed (title similarity via rapidfuzz if available)
DEDUPE_POLICY=
# Max pipeline attempts before moving to DLQ (default: 3)
MAX_PIPELINE_ATTEMPTS=
# Set to 1 for dry_run (print only, no real publish)
DRY_RUN=
WORKER_QUEUE_URL=
WORKER_BATCH_SIZE=

# Telethon (Telegram ingest — one-time login, then ingest from channels)
# Get API ID and hash from https://my.telegram.org
TELEGRAM_API_ID=
TELEGRAM_API_HASH=
# Session file path in container (default: /data/telethon/session); host dir mounted at ./data/telethon
TELETHON_SESSION_PATH=
# Minutes of history when ingesting Telegram (default: 60)
TELEGRAM_SINCE_MINUTES=

# Publish retry (shared by Telegram + Make; exponential backoff)
PUBLISH_MAX_ATTEMPTS=
PUBLISH_BACKOFF_BASE=
# Circuit breaker: failure threshold (default 5), recovery timeout seconds (default 60)
CIRCUIT_FAILURE_THRESHOLD=
CIRCUIT_RECOVERY_TIMEOUT=
# Parallel publish workers (default: 4); bounded pool for step_render_and_publish
PUBLISH_MAX_WORKERS=

# Render (WhatsApp message split)
# Max chars per message; split when exceeded (default: 3500)
WHATSAPP_MAX_CHARS=

# Publisher — Telegram (bot for sending; real Bot API)
TELEGRAM_BOT_TOKEN=
TELEGRAM_TARGET_CHAT_ID=
# Or TELEGRAM_CHAT_ID (fallback)
TELEGRAM_CHAT_ID=

# Publisher — WhatsApp Web (internal whatsapp-bot service). If unset, whatsapp_web runs in dry_run.
# Example (worker/API): WHATSAPP_BOT_BASE_URL=http://whatsapp-bot:3100
WHATSAPP_BOT_BASE_URL=

# WhatsApp QR Bridge (API proxy for remote UI, e.g. Streamlit Cloud). Do not expose whatsapp-bot directly.
# WA_BOT_BASE_URL: internal URL of whatsapp-bot (default http://whatsapp-bot:3100)
WA_BOT_BASE_URL=http://whatsapp-bot:3100
# WA_QR_BRIDGE_TOKEN: required Bearer token for GET /admin/wa/status and GET /admin/wa/qr (use long random string)
WA_QR_BRIDGE_TOKEN=CHANGE_ME_LONG_RANDOM
# WA_QR_TTL_SECONDS: Redis cache TTL for QR (default 120). WhatsApp QR expires ~60s; 120 allows buffer.
WA_QR_TTL_SECONDS=120
# WA_QR_RATE_LIMIT_PER_MINUTE: per-IP rate limit for /admin/wa/qr (default 20)
WA_QR_RATE_LIMIT_PER_MINUTE=20
# WA_KEEPALIVE_INTERVAL_SECONDS: background keepalive checks status, triggers reconnect if disconnected (default 25)
WA_KEEPALIVE_INTERVAL_SECONDS=25
# WA_RECONNECT_BACKOFF_SECONDS: backoff after keepalive errors (default 30)
WA_RECONNECT_BACKOFF_SECONDS=30
# STREAMLIT_ORIGIN: optional; add this origin to CORS for Streamlit Cloud (e.g. https://yourapp.streamlit.app)
STREAMLIT_ORIGIN=

# Publisher — Make (WhatsApp webhook). If unset, runs in dry_run.
# Example: MAKE_WEBHOOK_URL=https://f2mrd7aj3eijdl3k3h8cbt19dsgjdtor@hook.us2.make.com
MAKE_WEBHOOK_URL=
MAKE_WEBHOOK_TIMEOUT_SECONDS=15
MAKE_WEBHOOK_MAX_ATTEMPTS=5
MAKE_WEBHOOK_BACKOFF_BASE_SECONDS=2
# make_webhook channel: POST {phone, message, source, item_id}. Fallback when whatsapp_web fails.
MAKE_WEBHOOK_ENABLED=false
# MAKE_WEBHOOK_PHONE: optional target phone for make_webhook payload (empty = use webhook default)
# MAKE_WEBHOOK_PHONE=
MAKE_API_KEY=

# Data paths (optional overrides)
DATA_SOURCES_PATH=
DATA_KEYWORDS_PATH=
